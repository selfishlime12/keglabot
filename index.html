<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --accent: #0088cc;
            --bg: var(--tg-theme-bg-color, #0f0f0f);
            --text: var(--tg-theme-text-color, #ffffff);
            --sec-bg: var(--tg-theme-secondary-bg-color, #1c1c1d);
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding: 20px;
            overflow-x: hidden;
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .user-id { font-family: monospace; opacity: 0.5; font-size: 11px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–∞–Ω–≥–∞ */
        .rank-card {
            background: linear-gradient(135deg, #0088cc 0%, #004466 100%);
            border-radius: 20px; padding: 20px; text-align: center;
            margin-bottom: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            animation: fadeIn 0.8s ease;
        }
        .rank-icon { font-size: 40px; margin-bottom: 10px; display: block; }
        .rank-title { font-size: 20px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

        .glass-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px; padding: 20px;
            margin-bottom: 20px;
        }

        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .stat-label { font-size: 10px; text-transform: uppercase; opacity: 0.6; }
        .stat-val { font-size: 28px; font-weight: 800; color: var(--accent); }

        .history-item {
            background: var(--sec-bg);
            margin-bottom: 8px; padding: 12px 16px;
            border-radius: 16px; display: flex;
            justify-content: space-between; align-items: center;
            animation: slideIn 0.4s ease forwards;
        }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-15px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>
    <div class="header">
        <h1 style="margin:0; font-size: 22px;">–ö–∞–±–∏–Ω–µ—Ç</h1>
        <span class="user-id" id="uid">...</span>
    </div>

    <div class="rank-card" id="rank-box">
        <span class="rank-icon" id="rank-icon">üèÜ</span>
        <span class="rank-title" id="rank-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>

    <div class="glass-card">
        <div class="stats-row">
            <div><span class="stat-label">–ó–∞–ø—Ä–æ—Å—ã</span><div id="req" class="stat-val">0</div></div>
            <div><span class="stat-label">–í—Ö–æ–¥—ã</span><div id="ent" class="stat-val">0</div></div>
        </div>
        <canvas id="activityChart" style="max-height: 100px;"></canvas>
    </div>

    <div style="font-size: 14px; font-weight: 700; margin: 20px 0 10px 5px; opacity: 0.8;">–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</div>
    <div id="history-list"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        const params = new URLSearchParams(window.location.search);
        const reqCount = parseInt(params.get('req')) || 0;
        
        document.getElementById('uid').innerText = 'ID: ' + (params.get('uid') || '???');
        document.getElementById('req').innerText = reqCount;
        document.getElementById('ent').innerText = params.get('ent') || '0';

        // –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        const rankName = document.getElementById('rank-name');
        const rankIcon = document.getElementById('rank-icon');
        const rankBox = document.getElementById('rank-box');

        if (reqCount >= 100) {
            rankName.innerText = "–õ–µ–≥–µ–Ω–¥–∞"; rankIcon.innerText = "üëë";
            rankBox.style.background = "linear-gradient(135deg, #ff9d00 0%, #ff5e00 100%)";
        } else if (reqCount >= 50) {
            rankName.innerText = "–ê–Ω–∞–ª–∏—Ç–∏–∫"; rankIcon.innerText = "üî•";
            rankBox.style.background = "linear-gradient(135deg, #7b2ff7 0%, #4a00e0 100%)";
        } else if (reqCount >= 10) {
            rankName.innerText = "–û–ø—ã—Ç–Ω—ã–π"; rankIcon.innerText = "‚≠êÔ∏è";
        } else {
            rankName.innerText = "–ù–æ–≤–∏—á–æ–∫"; rankIcon.innerText = "üèÜ";
        }

        // –ì—Ä–∞—Ñ–∏–∫
        const ctx = document.getElementById('activityChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1', '2', '3', '4', '5', '6', '7'],
                datasets: [{
                    data: [1, 4, 2, 6, 3, 8, reqCount % 20], // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ + —Ä–µ–∞–ª—å–Ω—ã–π —Ö–≤–æ—Å—Ç
                    borderColor: '#fff',
                    borderWidth: 2,
                    tension: 0.4,
                    pointRadius: 0,
                    fill: false
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
        });

        // –ò—Å—Ç–æ—Ä–∏—è
        const hist = params.get('hist');
        if (hist) {
            const list = document.getElementById('history-list');
            decodeURIComponent(hist).split('\n').filter(t => t.trim()).reverse().slice(0, 5).forEach((item, idx) => {
                const parts = item.split(': ');
                const div = document.createElement('div');
                div.className = 'history-item';
                div.style.animationDelay = (idx * 0.1) + 's';
                div.innerHTML = `<span style="font-size:14px;">${parts[1] || item}</span><span style="font-size:10px; opacity:0.4;">${parts[0] || ''}</span>`;
                list.appendChild(div);
            });
        }

        tg.MainButton.setText("–ó–ê–ö–†–´–¢–¨");
        tg.MainButton.show();
        tg.MainButton.onClick(() => tg.close());
        tg.HapticFeedback.impactOccurred('medium');
    </script>
</body>
</html>
